# Test Summary: FAIL ❌

2025-12-30 12:51 - 2 Python files, 5 selftest endpoints

## Action Required

### 2025-12-30_12-51_TEST_FAIL_001

- **File -> Test**: `/openaiproxyselftest` -> `POST /vector_stores/{id}/search`
- **What is it testing?**: Vector store search endpoint functionality
- **Why did it fail?**: HTTP 404 - Resource not found
- **Fix Option A (recommended)**: Check if the Azure OpenAI API supports the `/vector_stores/{id}/search` endpoint in the current API version (2025-04-01-preview). This endpoint may not be available in Azure OpenAI.
- **Fix Option B**: Update the selftest to skip this endpoint test if using Azure OpenAI, or mark it as expected to fail with a clear comment.

### 2025-12-30_12-51_TEST_FAIL_002

- **File -> Test**: `/openaiproxyselftest` -> `GET /vector_stores/{id}/files/{file_id}`
- **What is it testing?**: Retrieving vector store file with custom attributes
- **Why did it fail?**: Attribute validation failed - attrs_count=0, all_match=False (expected custom attributes not preserved)
- **Fix Option A (recommended)**: Investigate why custom attributes are not being returned when retrieving vector store files. Check if Azure OpenAI API supports custom attributes on vector store files.
- **Fix Option B**: Update the test to reflect actual Azure OpenAI API behavior if custom attributes are not supported.

### 2025-12-30_12-51_TEST_FAIL_003

- **File -> Test**: `/openaiproxyselftest` -> `GET /vector_stores/{id}/files`
- **What is it testing?**: Listing vector store files with custom attributes
- **Why did it fail?**: Attribute validation failed - attrs_count=0, all_match=False (expected custom attributes not in list response)
- **Fix Option A (recommended)**: Similar to FAIL_002, investigate attribute support in list endpoint
- **Fix Option B**: Align test expectations with actual API capabilities

### 2025-12-30_12-51_TEST_FAIL_004

- **File -> Test**: `/openaiproxyselftest` -> `GET /vector_stores/{id}/files/{file_id}/content`
- **What is it testing?**: Retrieving vector store file content
- **Why did it fail?**: HTTP 404 - Resource not found
- **Fix Option A (recommended)**: Check if this endpoint is supported in Azure OpenAI API. This may be an OpenAI.com-only endpoint.
- **Fix Option B**: Skip this test for Azure OpenAI deployments or mark as expected failure.

### 2025-12-30_12-51_TEST_FAIL_005

- **File -> Test**: `/openaiproxyselftest` -> `POST /vector_stores/{id}/files/{file_id}`
- **What is it testing?**: Updating vector store file attributes
- **Why did it fail?**: HTTP 404 - Resource not found
- **Fix Option A (recommended)**: Verify if Azure OpenAI supports updating file attributes. This endpoint may not exist in Azure's implementation.
- **Fix Option B**: Remove test or mark as Azure-incompatible.

### 2025-12-30_12-51_TEST_FAIL_006

- **File -> Test**: `/openaiproxyselftest` -> `GET /vector_stores/{id}/files/{file_id}` (after update)
- **What is it testing?**: Verifying file attributes after update
- **Why did it fail?**: Attribute validation failed - attrs_count=0, all_match=False (previous update failed, so attributes weren't updated)
- **Fix Option A (recommended)**: This will be resolved once FAIL_005 is fixed
- **Fix Option B**: Skip if attribute updates are not supported

### 2025-12-30_12-51_TEST_FAIL_007

- **File -> Test**: `/openaiproxyselftest` -> `GET /vector_stores/{id}/files` (list after update)
- **What is it testing?**: Verifying file list includes updated attributes
- **Why did it failed?**: Attribute validation failed - attrs_count=0, all_match=False (cascading failure from FAIL_005)
- **Fix Option A (recommended)**: Will be resolved with FAIL_005
- **Fix Option B**: Skip if not supported

### 2025-12-30_12-51_TEST_FAIL_008

- **File -> Test**: `/v2/demorouter1/selftest` -> `Intentional failure test`
- **What is it testing?**: Intentional failure for testing purposes
- **Why did it fail?**: This is a deliberate test failure with message "Intentional failure - remove this test in production"
- **Fix Option A (recommended)**: Remove or comment out this intentional failure test from the selftest suite
- **Fix Option B**: Mark this test to be skipped in production environments

## Failed Tests

### /openaiproxyselftest - FAIL ❌ (33 passed, 8 failed)

```
/vector_stores/{id}/search (POST) - ❌ HTTP 404 (619 ms) - Error: Resource not found
/vector_stores/{id}/files/{file_id} (GET with attributes) - ❌ OK (687 ms) - attrs_count: 0; all_match: False
/vector_stores/{id}/files (GET list with attributes) - ❌ OK (716 ms) - attrs_count: 0; all_match: False
/vector_stores/{id}/files/{file_id}/content (GET) - ❌ HTTP 404 (593 ms) - Error: Resource not found
/vector_stores/{id}/files/{file_id} (POST update attributes) - ❌ HTTP 404 (637 ms) - Error: Resource not found
/vector_stores/{id}/files/{file_id} (GET after update) - ❌ OK (798 ms) - attrs_count: 0; all_match: False
/vector_stores/{id}/files (GET list after update) - ❌ OK (744 ms) - attrs_count: 0; all_match: False
```

### /v2/demorouter1/selftest - FAIL ❌ (41 passed, 1 failed)

```
[2025-12-30 12:50:10]   FAIL: Intentional failure - remove this test in production
```

## All Results

### Python Test Files
- ✅ OK: `./src/routers_v2/common_report_functions_v2_test.py` (68 tests)
- ✅ OK: `./src/routers_v2/common_sharepoint_functions_v2_test.py` (53 tests)

### Selftest Endpoints
- ❌ FAIL: `/openaiproxyselftest` (33 passed, 8 failed)
- ❌ FAIL: `/v2/demorouter1/selftest` (41 passed, 1 failed)
- ✅ OK: `/v2/demorouter2/selftest` (18 tests)
- ✅ OK: `/v2/domains/selftest` (29 tests)
- ✅ OK: `/v2/jobs/selftest` (46 tests)
