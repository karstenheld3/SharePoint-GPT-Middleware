# Test Summary: FAIL ❌

2025-12-30 13:20 - 2 Python files, 5 selftest endpoints

## All Results

### Python Test Files
- ✅ OK: `./src/routers_v2/common_report_functions_v2_test.py` (68 tests)
- ✅ OK: `./src/routers_v2/common_sharepoint_functions_v2_test.py` (53 tests)

### Selftest Endpoints
- ❌ PARTIAL: `/openaiproxyselftest` (32 passed, 7 failed)
- ❌ FAIL: `/v2/demorouter1/selftest` (41 passed, 1 failed)
- ✅ OK: `/v2/demorouter2/selftest` (18 tests)
- ✅ OK: `/v2/domains/selftest` (29 tests)
- ✅ OK: `/v2/jobs/selftest` (46 tests)

## Failed Tests

### /openaiproxyselftest - PARTIAL ❌ (32 passed, 7 failed)

```
❌ HTTP 404: /vector_stores/{id}/search (POST)
❌ OK: /vector_stores/{id}/files/{file_id} (GET with attributes) - attrs_count: 0; all_match: False
❌ OK: /vector_stores/{id}/files (GET list with attributes) - attrs_count: 0; all_match: False
❌ HTTP 404: /vector_stores/{id}/files/{file_id}/content (GET)
❌ HTTP 404: /vector_stores/{id}/files/{file_id} (POST update attributes)
❌ OK: /vector_stores/{id}/files/{file_id} (GET after update) - attrs_count: 0; all_match: False
❌ OK: /vector_stores/{id}/files (GET list after update) - attrs_count: 0; all_match: False
```

### /v2/demorouter1/selftest - FAIL ❌ (41 passed, 1 failed)

```
[2025-12-30 13:17:27]   FAIL: Intentional failure - remove this test in production
[2025-12-30 13:17:27] OK: 41, FAIL: 1
```

## Action Required

### 2025-12-30_13-20_TEST_FAIL_001

- **File -> Test**: `/openaiproxyselftest` -> `POST /vector_stores/{id}/search`
- **What is it testing?**: Testing the vector store search endpoint functionality
- **Why did it fail?**: HTTP 404 - Resource not found. The endpoint `/vector_stores/{id}/search` is not implemented or routed correctly
- **Fix Option A (recommended)**: Implement the POST `/vector_stores/{id}/search` endpoint in the OpenAI proxy router
- **Fix Option B**: If the endpoint is intentionally not supported, document it as a known limitation and remove from selftest

### 2025-12-30_13-20_TEST_FAIL_002

- **File -> Test**: `/openaiproxyselftest` -> `GET /vector_stores/{id}/files/{file_id} with attributes`
- **What is it testing?**: Verifying that custom attributes are correctly stored and retrieved with vector store files
- **Why did it fail?**: The test expects custom attributes to be preserved, but `attrs_count: 0; all_match: False` indicates attributes are not being stored or returned
- **Fix Option A (recommended)**: Fix the vector store file metadata handling to preserve custom attributes during storage and retrieval
- **Fix Option B**: Update Azure OpenAI API integration to properly pass through metadata/attributes fields

### 2025-12-30_13-20_TEST_FAIL_003

- **File -> Test**: `/openaiproxyselftest` -> `GET /vector_stores/{id}/files list with attributes`
- **What is it testing?**: Verifying that custom attributes are present when listing vector store files
- **Why did it fail?**: Similar to TEST_FAIL_002 - attributes are not being preserved in list responses (`attrs_count: 0`)
- **Fix Option A (recommended)**: Ensure the list endpoint includes custom attributes in the response data
- **Fix Option B**: Check if Azure OpenAI API supports metadata in list operations; may need workaround

### 2025-12-30_13-20_TEST_FAIL_004

- **File -> Test**: `/openaiproxyselftest` -> `GET /vector_stores/{id}/files/{file_id}/content`
- **What is it testing?**: Retrieving the raw content of a file in a vector store
- **Why did it fail?**: HTTP 404 - Resource not found. This endpoint is not implemented
- **Fix Option A (recommended)**: Implement the GET `/vector_stores/{id}/files/{file_id}/content` endpoint to return file content
- **Fix Option B**: If Azure OpenAI doesn't support this operation, remove from selftest and document limitation

### 2025-12-30_13-20_TEST_FAIL_005

- **File -> Test**: `/openaiproxyselftest` -> `POST /vector_stores/{id}/files/{file_id} update attributes`
- **What is it testing?**: Updating custom attributes on an existing vector store file
- **Why did it fail?**: HTTP 404 - Resource not found. The POST method for updating file attributes is not implemented
- **Fix Option A (recommended)**: Implement POST endpoint to update vector store file metadata/attributes
- **Fix Option B**: If Azure OpenAI doesn't support attribute updates, use PATCH or PUT method, or remove test

### 2025-12-30_13-20_TEST_FAIL_006

- **File -> Test**: `/openaiproxyselftest` -> `GET /vector_stores/{id}/files/{file_id} after update`
- **What is it testing?**: Verifying that updated attributes persist after an update operation
- **Why did it fail?**: This is a cascading failure from TEST_FAIL_005. Since the update failed (404), attributes remain at 0
- **Fix Option A (recommended)**: Fix TEST_FAIL_005 first - once attribute updates work, this test should pass
- **Fix Option B**: N/A - depends on resolving the update endpoint issue

### 2025-12-30_13-20_TEST_FAIL_007

- **File -> Test**: `/openaiproxyselftest` -> `GET /vector_stores/{id}/files list after update`
- **What is it testing?**: Verifying that the file list reflects updated attributes
- **Why did it fail?**: Cascading failure from TEST_FAIL_005. No attributes to display because update never succeeded
- **Fix Option A (recommended)**: Fix TEST_FAIL_005 first - once attribute updates work, this test should pass
- **Fix Option B**: N/A - depends on resolving the update endpoint issue

### 2025-12-30_13-20_TEST_FAIL_008

- **File -> Test**: `/v2/demorouter1/selftest` -> `Intentional failure test`
- **What is it testing?**: This is an intentional test failure to verify that the test framework properly reports failures
- **Why did it fail?**: This test is designed to fail as a sanity check
- **Fix Option A (recommended)**: Remove this intentional failure test from production code - it's only needed during development
- **Fix Option B**: Add a flag to skip this test in production environments (e.g., `SKIP_INTENTIONAL_FAILURES=true`)
